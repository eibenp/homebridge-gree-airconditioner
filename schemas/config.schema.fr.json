{
  "pluginAlias": "GREEAirConditioner",
  "pluginType": "platform",
  "singular": true,
  "strictValidation": false,
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "type": "string",
        "required": true,
        "default": "GREE Air Conditioner"
      },
      "port": {
        "type": "integer",
        "required": false,
        "minimum": 1025
      },
      "scanInterval": {
        "type": "integer",
        "required": false,
        "default": 60,
        "minimum": 5
      },
      "disableAutoDetection": {
        "type": "boolean",
        "default": false
      },
      "devices": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "mac": {
              "type": "string",
              "required": true,
              "pattern": "^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$"
            },
            "name": {
              "type": "string",
              "required": false
            },
            "model": {
              "type": "string",
              "required": false
            },
            "speedSteps": {
              "type": "integer",
              "required": true,
              "default": 5,
              "oneOf": [
                {
                  "title": "Modèle à 3 vitesses",
                  "enum": [
                    3
                  ]
                },
                {
                  "title": "Modèle à 5 vitesses",
                  "enum": [
                    5
                  ]
                }
              ]
            },
            "statusUpdateInterval": {
              "type": "integer",
              "required": false,
              "minimum": 1,
              "placeholder": 10
            },
            "sensorOffset": {
              "type": "integer",
              "required": false,
              "placeholder": 40
            },
            "minimumTargetTemperature": {
              "type": "integer",
              "required": false,
              "minimum": 8,
              "placeholder": 16
            },
            "maximumTargetTemperature": {
              "type": "integer",
              "required": false,
              "maximum": 30,
              "placeholder": 30
            },
            "xFanEnabled": {
              "type": "boolean",
              "default": true
            },
            "temperatureSensor": {
              "type": "string",
              "required": true,
              "default": "disabled",
              "oneOf": [
                {
                  "title": "Désactivé",
                  "enum": [
                    "disabled"
                  ]
                },
                {
                  "title": "Accessoire subordonné",
                  "enum": [
                    "child"
                  ]
                },
                {
                  "title": "Accessoire indépendant",
                  "enum": [
                    "separate"
                  ]
                }
              ]
            },
            "temperatureStepSize": {
              "type": "number",
              "minimum": 0.5,
              "multipleOf": 0.5,
              "required": false
            },
            "disabled": {
              "type": "boolean"
            },
            "modifyVerticalSwingPosition": {
              "type": "integer",
              "required": true,
              "default": 0,
              "oneOf": [
                {
                  "title": "Jamais",
                  "enum": [
                    0
                  ]
                },
                {
                  "title": "Remplacer le réglage par défaut après la mise sous tension",
                  "enum": [
                    1
                  ]
                },
                {
                  "title": "Remplacer le réglage par défaut après la mise sous tension ou l’arrêt de l’oscillation",
                  "enum": [
                    2
                  ]
                },
                {
                  "title": "Toujours définir après la mise sous tension",
                  "enum": [
                    3
                  ]
                },
                {
                  "title": "Toujours définir après la mise sous tension ou l’arrêt de l’oscillation",
                  "enum": [
                    4
                  ]
                }
              ]
            },
            "defaultVerticalSwing": {
              "type": "integer",
              "required": true,
              "default": 0,
              "oneOf": [
                {
                  "title": "Réglage par défaut de l’appareil",
                  "enum": [
                    0
                  ]
                },
                {
                  "title": "Fixé – Maximum",
                  "enum": [
                    2
                  ]
                },
                {
                  "title": "Fixé – Élevé",
                  "enum": [
                    3
                  ]
                },
                {
                  "title": "Fixé – Moyen",
                  "enum": [
                    4
                  ]
                },
                {
                  "title": "Fixé – Faible",
                  "enum": [
                    5
                  ]
                },
                {
                  "title": "Fixé – Minimum",
                  "enum": [
                    6
                  ]
                }
              ]
            },
            "defaultFanVerticalSwing": {
              "type": "integer",
              "required": true,
              "default": 0,
              "oneOf": [
                {
                  "title": "Réglage par défaut de l’appareil",
                  "enum": [
                    0
                  ]
                },
                {
                  "title": "Fixé – Maximum",
                  "enum": [
                    2
                  ]
                },
                {
                  "title": "Fixé – Élevé",
                  "enum": [
                    3
                  ]
                },
                {
                  "title": "Fixé – Moyen",
                  "enum": [
                    4
                  ]
                },
                {
                  "title": "Fixé – Faible",
                  "enum": [
                    5
                  ]
                },
                {
                  "title": "Fixé – Minimum",
                  "enum": [
                    6
                  ]
                }
              ]
            },
            "encryptionVersion" : {
              "type": "integer",
              "required": true,
              "default": 0,
              "oneOf": [
                {
                  "title": "Automatique",
                  "enum": [
                    0
                  ]
                },
                {
                  "title": "v1",
                  "enum": [
                    1
                  ]
                },
                {
                  "title": "v2",
                  "enum": [
                    2
                  ]
                }
              ]
            },
            "port": {
              "type": "integer",
              "required": false,
              "minimum": 1025
            },
            "ip": {
              "type": "string",
              "required": false,
              "format": "ipv4"
            },
            "fanControlEnabled": {
              "type": "boolean"
            },
            "silentTimeRange": {
              "type": "string",
              "required": false,
              "pattern": "^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]-(((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])|24:00)$"
            }
          }
        }
      }
    }
  },
  "layout": [
    {
      "key": "name",
      "title": "Nom :"
    },
    {
      "type": "flex",
      "flex-flow": "row wrap",
      "items": [
        {
          "key": "port",
          "flex": "1 1 50%",
          "title": "Port :",
          "description": "Port UDP du pont utilisé pour la détection des appareils (automatique si vide)"
        },
        {
          "key": "scanInterval",
          "flex": "1 1 50%",
          "title": "Intervalle de recherche :",
          "description": "Intervalle entre les tentatives de détection en secondes (60 s si vide)"
        },
        {
          "key": "disableAutoDetection",
          "flex": "1 1 100%",
          "title": "Désactiver la détection automatique",
          "description": "Si la détection automatique est désactivée, seuls les climatiseurs listés dans Appareils seront disponibles"
        }
      ]
    },
    {
      "type": "array",
      "key": "devices",
      "title": "Appareils",
      "buttonText": "Ajouter un appareil",
      "expandable": true,
      "expanded": false,
      "items": [
        {
          "type": "div",
          "displayFlex": true,
          "flex-flow": "row wrap",
          "items": [
            {
              "key": "devices[].mac",
              "flex": "1 1 50%",
              "title": "Adresse MAC (numéro de série) :",
              "description": "Adresse MAC en minuscules sans séparateurs<br />OU<br />valeur spéciale : <b>default</b>"
            },
            {
              "key": "devices[].name",
              "flex": "1 1 50%",
              "title": "Nom de l’appareil :",
              "description": "Nom personnalisé de l’appareil. Utilise uniquement des caractères alphanumériques, des espaces et des apostrophes. Commencer et se terminer par une lettre ou un chiffre. Les emojis ne sont pas pris en charge.",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac));"
              }
            },
            {
              "key": "devices[].disabled",
              "flex": "1 1 100%",
              "title": "Désactivé",
              "description": "Si activé, cet accessoire sera supprimé et ignoré par Maison",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac));"
              }
            },
            {
              "key": "devices[].ip",
              "flex": "1 1 50%",
              "title": "Adresse IP :",
              "description": "Adresse IP de l’appareil (automatique si vide)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].port",
              "flex": "1 1 50%",
              "title": "Port :",
              "description": "Port UDP spécifique à l’appareil (automatique si vide)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].statusUpdateInterval",
              "flex": "1 1 50%",
              "title": "Intervalle de mise à jour de l’état :",
              "description": "Intervalle en secondes",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].encryptionVersion",
              "flex": "1 1 50%",
              "title": "Version du chiffrement du protocole réseau :",
              "description": "Laisse sur Automatique. Si cela ne fonctionne pas, sélectionne une version spécifique.",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default)$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].model",
              "flex": "1 1 50%",
              "title": "Modèle de l’appareil :",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].speedSteps",
              "flex": "1 1 50%",
              "title": "Vitesses du ventilateur :",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].minimumTargetTemperature",
              "flex": "1 1 50%",
              "title": "Température cible minimale :",
              "description": "Température cible minimale (°C)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].maximumTargetTemperature",
              "flex": "1 1 50%",
              "title": "Température cible maximale :",
              "description": "Température cible maximale (°C)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].sensorOffset",
              "flex": "1 1 50%",
              "title": "Correction de température :",
              "description": "Étalonnage du capteur de température (°C)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].temperatureStepSize",
              "flex": "1 1 50%",
              "title": "Pas de réglage de la température :",
              "description": "Valeurs valides : 0,5 (°F) et 1 (°C)<BR />(Si vide ou invalide, elle sera calculée selon les réglages de Homebridge)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].xFanEnabled",
              "flex": "1 1 50%",
              "title": "X-FAN activé",
              "description": "Si activée, la fonction X-FAN s’active automatiquement sur l’appareil lors de l’extinction.",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].temperatureSensor",
              "flex": "1 1 50%",
              "title": "Capteur de température :",
              "description": "Capteur de température supplémentaire dans l’app Maison",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].modifyVerticalSwingPosition",
              "flex": "1 1 50%",
              "title": "Modifier la position verticale :",
              "description": "Quand modifier la position verticale des ailettes",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].defaultVerticalSwing",
              "flex": "1 1 50%",
              "title": "Position verticale :",
              "description": "Position verticale des ailettes pour les modes chauffage/refroidissement",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true && model.devices[arrayIndices].modifyVerticalSwingPosition !== 0);"
              }
            },
            {
              "key": "devices[].fanControlEnabled",
              "flex": "1 1 50%",
              "title": "Commande du ventilateur activée",
              "description": "Si activé, une commande de ventilateur est ajoutée à l’app Maison",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            },
            {
              "key": "devices[].defaultFanVerticalSwing",
              "flex": "1 1 50%",
              "title": "Position verticale du ventilateur :",
              "description": "Position verticale des ailettes à définir en mode ventilateur",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true && [3, 4].includes(model.devices[arrayIndices].modifyVerticalSwingPosition) && model.devices[arrayIndices].fanControlEnabled === true);"
              }
            },
            {
              "key": "devices[].silentTimeRange",
              "flex": "1 1 50%",
              "title": "Plage horaire silencieuse :",
              "description": "Plage horaire pendant laquelle l’appareil n’émet aucun bip (format : HH:MM-HH:MM, par exemple : 22:00-08:30)",
              "condition": {
                "functionBody": "return (model.devices && model.devices[arrayIndices] && model.devices[arrayIndices].mac && /^([a-f0-9]{12}|default|[a-f0-9]+@[a-f0-9]{12})$/.test(model.devices[arrayIndices].mac) && model.devices[arrayIndices].disabled !== true);"
              }
            }
          ]
        }
      ]
    }
  ]
}
